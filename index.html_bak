<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="/vite.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MolViewSpec Live</title>
        <link rel="stylesheet" href="/src/styles.css" />
        <!-- Load Molstar library -->
        <script src="https://cdn.jsdelivr.net/npm/molstar@latest/build/viewer/molstar.js"></script>
        <link
            rel="stylesheet"
            type="text/css"
            href="https://cdn.jsdelivr.net/npm/molstar@latest/build/viewer/molstar.css"
        />
    </head>
    <body>
        <div class="container">
            <h1>MolViewSpec Live</h1>
            <p>Choose an implementation to use:</p>
            <div class="language-tabs">
                <div class="language-tab active" id="python-tab">Python</div>
                <div class="language-tab" id="js-tab">
                    JavaScript (CodeMirror)
                </div>
                <div class="language-tab" id="monaco-tab">
                    JavaScript (Monaco)
                </div>
            </div>

            <div id="js-container" style="display: none">
                <div id="app_js"></div>
            </div>

            <div id="monaco-container" style="display: none">
                <div id="app_monaco"></div>
            </div>
        </div>

        <script type="module">
            import { appInit } from "/src/main.mjs";

            const jsTab = document.getElementById("js-tab");
            const monacoTab = document.getElementById("monaco-tab");
            const pythonContainer = document.getElementById("python-container");
            const jsContainer = document.getElementById("js-container");
            const monacoContainer = document.getElementById("monaco-container");

            // Initialize apps
            const app_div = document.querySelector("#app");
            const app_js_div = document.querySelector("#app_js");
            const app_monaco_div = document.querySelector("#app_monaco");

            // Python example
            const init_code = `from molviewspec import create_builder
import json

builder = create_builder()
structure = (builder
  .download(url="https://www.ebi.ac.uk/pdbe/entry-files/download/1cbs_updated.cif")
  .parse(format="mmcif")
  .model_structure()
  .component()
  .representation()
  .color(color="blue")
)
builder.get_state().dumps()
`;

            // JavaScript example with type hints
            const init_js_code = `// Create a builder for molecular visualization
const builder = molstar.PluginExtensions.mvs.MVSData.createBuilder();

// Define the structure with full type support
const structure = builder
    .download({
        url: 'https://www.ebi.ac.uk/pdbe/entry-files/1cbs.bcif',
    })
    .parse({ format: 'bcif' })
    .modelStructure({});

// Add components and representations
structure
    .component({ selector: 'polymer' })
    .representation({ type: 'cartoon' })
    .color({ color: 'green' });

// Add ligand
structure
    .component({ selector: 'ligand' })
    .label({ text: 'Retinoic Acid' })
    .focus({})
    .representation({ type: 'ball_and_stick' })
    .color({
        color: '#cc3399',
        // Try typing "theme:" to see color theme options
    });

// Get the final state - this variable is used by the system
const mvsData = builder.getState();
`;

            // Initialize Python app
            appInit(app_div, null, init_code, "python");

            // Initialize JS and Monaco apps (deferred)
            let jsInitialized = false;
            let monacoInitialized = false;

            // Tab switching

            jsTab.addEventListener("click", () => {
                jsTab.classList.add("active");
                pythonTab.classList.remove("active");
                monacoTab.classList.remove("active");
                jsContainer.style.display = "block";
                pythonContainer.style.display = "none";
                monacoContainer.style.display = "none";

                // Initialize JS app if not already done
                if (!jsInitialized) {
                    appInit(app_js_div, null, init_js_code, "js");
                    jsInitialized = true;
                }
            });

            monacoTab.addEventListener("click", () => {
                monacoTab.classList.add("active");
                pythonTab.classList.remove("active");
                jsTab.classList.remove("active");
                monacoContainer.style.display = "block";
                pythonContainer.style.display = "none";
                jsContainer.style.display = "none";

                // Initialize Monaco app if not already done
                if (!monacoInitialized) {
                    appInit(app_monaco_div, null, init_js_code, "js", "monaco");
                    monacoInitialized = true;
                }
            });
        </script>
    </body>
</html>
